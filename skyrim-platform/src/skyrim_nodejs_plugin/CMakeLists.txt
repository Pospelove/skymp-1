project(skyrim_nodejs_plugin LANGUAGES CXX)

if(MSVC)
    #file(GLOB_RECURSE installed "${CMAKE_BINARY_DIR}/vcpkg_installed/*")
    #foreach(v ${installed})
    #    message(STATUS ${v})
    #endforeach()
    #message(FATAL_ERROR "FOTAL IRAR")

    add_library(node-embedder-api INTERFACE)
    find_path(node_INCLUDE_DIR NAMES js_native_api.h PATH_SUFFIXES node-embedder-api)
    find_library(node_LIBRARY_Debug NAMES node)
    string(REPLACE "/debug/lib/" "/lib/" node_LIBRARY_Release "${node_LIBRARY_Debug}")
    target_link_libraries(node-embedder-api INTERACE "$<IF:$<CONFIG:Debug>,${node_LIBRARY_Debug},${node_LIBRARY_Release}>")
    target_include_directories(node-embedder-api INTERACE ${node_INCLUDE_DIR})

    file(GLOB_RECURSE src "./*")
    add_library(skyrim_nodejs_plugin SHARED ${src})
    target_link_libraries(skyrim_nodejs_plugin PUBLIC node-embedder-api)
endif()
